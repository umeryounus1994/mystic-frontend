<ngx-spinner bdColor="rgba(51,51,51,0.8)" size="medium" color="#fff" type="ball-scale-multiple" [fullScreen]="true">
    <p style="font-size: 30px; color: white">Fetching Data....</p>
</ngx-spinner>
<div class="row mb-3">
    <div class="col-12 d-sm-flex justify-content-between align-items-center">
        <h1 class="h3 mb-2 mb-sm-0">Users</h1>
        <div class="d-flex gap-2">
            <select class="form-select" [(ngModel)]="selectedFilter" (change)="applyFilter()" style="width: auto;">
                <option *ngFor="let option of filterOptions" [value]="option.value">
                    {{option.label}}
                </option>
            </select>
            <button class="btn btn-primary" (click)="showRewardDialog()">Add Sub Admin</button>
        </div>
    </div>
</div>

<div class="row g-4 mb-4">
    <div class="col-sm-4 col-lg-4">
        <div class="text-center p-4 bg-primary bg-opacity-10 border border-primary rounded-3">
            <h6>Total Users</h6>
            <h2 class="mb-0 fs-1 text-primary">{{counters.users}}</h2>
        </div>
    </div>
    <div class="col-sm-4 col-lg-4">
        <div class="text-center p-4 bg-success bg-opacity-10 border border-success rounded-3">
            <h6>Active</h6>
            <h2 class="mb-0 fs-1 text-success">{{counters.active}}</h2>
        </div>
    </div>
    <div class="col-sm-4 col-lg-4">
        <div class="text-center p-4  bg-warning bg-opacity-15 border border-warning rounded-3">
            <h6>Inactive</h6>
            <h2 class="mb-0 fs-1 text-warning">{{counters.inactive}}</h2>
        </div>
    </div>
</div>
<div class="card bg-transparent border">
    <div class="card-body mt-2">
        <div class="table-responsive border-0 rounded-3" *ngIf="filteredUsers.length > 0">
            <table datatable [dtOptions]="dtOptions" class="table table-hover align-middle mb-0 modern-table"
                id="dtable">
                <thead class="table-header">
                    <tr>
                        <th scope="col" class="border-0 fw-bold text-uppercase">
                            <i class="bi bi-person me-2"></i>Username
                        </th>
                        <th scope="col" class="border-0 fw-bold text-uppercase">
                            <i class="bi bi-circle-fill me-2"></i>Status
                        </th>
                        <th scope="col" class="border-0 fw-bold text-uppercase">
                            <i class="bi bi-tag me-2"></i>Type
                        </th>
                        <th scope="col" class="border-0 fw-bold text-uppercase text-center">
                            <i class="bi bi-gear me-2"></i>Actions
                        </th>
                        <th scope="col" class="border-0 fw-bold text-uppercase text-center rounded-end">
                            <i class="bi bi-lock me-2"></i>Status Control
                        </th>
                    </tr>
                </thead>
                <tbody>
                    <tr *ngFor="let q of filteredUsers; let i = index" class="table-row">
                        <td class="user-cell">
                            <div class="d-flex align-items-center">
                                <div class="user-avatar me-3">
                                    <i class="bi bi-person-circle fs-4 text-primary"></i>
                                </div>
                                <div>
                                    <span class="fw-semibold text-dark">{{q.username}}</span>
                                </div>
                            </div>
                        </td>
                        
                        <td>
                            <div *ngIf="q.status == 'active'"
                                class="badge bg-success bg-opacity-15 text-success px-3 py-2 rounded-pill">
                                <i class="bi bi-check-circle me-1"></i>Active
                            </div>
                            <div *ngIf="q.status == 'blocked'"
                                class="badge bg-danger bg-opacity-15 text-danger px-3 py-2 rounded-pill">
                                <i class="bi bi-x-circle me-1"></i>Blocked
                            </div>
                            <div *ngIf="(q.approval_status == 'pending' || q.status == 'pending') && (q.user_role === 'partner' || q.user_role === 'family' || q.type === 'partner' || q.type === 'family')"
                                class="badge bg-warning bg-opacity-15 text-warning px-3 py-2 rounded-pill">
                                <i class="bi bi-clock me-1"></i>Pending
                            </div>
                        </td>
                        <td>
                            <div *ngIf="q?.user_role === 'admin' || q?.type === 'admin'" 
                                 class="badge bg-primary bg-opacity-15 text-primary px-3 py-2 rounded-pill">
                                <i class="bi bi-shield-check me-1"></i>Admin
                            </div>
                            <div *ngIf="q?.user_role === 'subadmin' || q?.type === 'subadmin'" 
                                 class="badge bg-secondary bg-opacity-15 text-secondary px-3 py-2 rounded-pill">
                                <i class="bi bi-person-gear me-1"></i>Sub Admin
                            </div>
                            <div *ngIf="q?.user_role === 'user' || q?.type === 'user'" 
                                 class="badge bg-info bg-opacity-15 text-info px-3 py-2 rounded-pill">
                                <i class="bi bi-person me-1"></i>User
                            </div>
                            <div *ngIf="q?.user_role === 'family' || q?.type === 'family'" 
                                 class="badge bg-success bg-opacity-15 text-success px-3 py-2 rounded-pill">
                                <i class="bi bi-house-heart me-1"></i>Family
                            </div>
                            <div *ngIf="q?.user_role === 'partner' || q?.type === 'partner'" 
                                 class="badge bg-warning bg-opacity-15 text-warning px-3 py-2 rounded-pill">
                                <i class="bi bi-handshake me-1"></i>Partner
                            </div>
                        </td>
                        <td class="text-center">
                            <div class="btn-group" role="group">
                                <button class="btn btn-outline-danger btn-sm rounded-pill me-1"
                                    (click)="deleteExamModal(q.id)"
                                    data-bs-toggle="tooltip" 
                                    data-bs-placement="top" 
                                    data-bs-title="Delete User">
                                    <i class="bi bi-trash"></i>
                                </button>
                                <button *ngIf="(q.user_role === 'partner' || q.user_role === 'family' || q.type === 'partner' || q.type === 'family') && (q.approval_status === 'pending' || q.status === 'pending')" 
                                        class="btn btn-outline-success btn-sm rounded-pill me-1"
                                        (click)="approveUser(q.id)"
                                        data-bs-toggle="tooltip" 
                                        data-bs-placement="top" 
                                        data-bs-title="Approve User">
                                    <i class="bi bi-check-circle"></i>
                                </button>
                                <button *ngIf="(q.user_role === 'partner' || q.user_role === 'family' || q.type === 'partner' || q.type === 'family') && (q.approval_status === 'pending' || q.status === 'pending')" 
                                        class="btn btn-outline-danger btn-sm rounded-pill"
                                        (click)="rejectUser(q.id)"
                                        data-bs-toggle="tooltip" 
                                        data-bs-placement="top" 
                                        data-bs-title="Reject User">
                                    <i class="bi bi-x-circle"></i>
                                </button>
                            </div>
                        </td>
                        <td class="text-center">
                            <button *ngIf="q.status == 'active'" class="btn btn-outline-warning btn-sm rounded-pill px-3"
                                (click)="blockUser(q.id, 'block')"
                                data-bs-toggle="tooltip" 
                                data-bs-placement="top" 
                                data-bs-title="Block User">
                                <i class="bi bi-lock me-1"></i>Block
                            </button>
                            <button *ngIf="q.status == 'blocked'" class="btn btn-outline-success btn-sm rounded-pill px-3"
                                (click)="blockUser(q.id, 'unblock')"
                                data-bs-toggle="tooltip" 
                                data-bs-placement="top" 
                                data-bs-title="Activate User">
                                <i class="bi bi-unlock me-1"></i>Activate
                            </button>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="modal fade" id="addProfession" tabindex="-1" aria-labelledby="appDetaillabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-dark">
                <h5 class="modal-title text-white" id="appDetaillabel">Add SubAdmin</h5>
                <button type="button" class="btn btn-sm btn-light mb-0" data-bs-dismiss="modal" aria-label="Close"><i class="bi bi-x-lg"></i></button>
            </div>
            <div class="modal-body p-5">
                <div class="row">
                    <div class="col-md-6">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" placeholder="Email" id="email">
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Password</label>
                        <input type="password" class="form-control" placeholder="Password" id="password">
                        <br />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Username</label>
                        <input type="text" class="form-control" placeholder="Username" id="username">
                    </div>
             
                    <div class="col-md-6">
                        <label class="form-label">Allowed Quests?</label>
                        <input type="number" class="form-control" placeholder="Allowed Quests?" id="allowed_quest" value="0">
                        <br />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">Allowed Hunts?</label>
                        <input type="number" class="form-control" placeholder="Allowed Hunts?" id="allowed_hunt" value="0">
                        <br />
                    </div>
                    <div class="col-md-12">
                        <label class="form-label">Permissions</label>
                        <div class="d-sm-flex">
                            <div class="form-check radio-bg-light me-4" *ngFor="let perm of permissionList">
                                <input class="form-check-input"
                                       type="checkbox"
                                       [id]="perm.id"
                                       [value]="perm.label"
                                       (change)="onPermissionChange($event)">
                                <label class="form-check-label" [for]="perm.id">
                                  {{ perm.label }}
                                </label>
                              </div>
                        </div>
                        <br />
                    </div>
                    
                </div>
                <br />
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary-soft my-0" (click)="saveRequest()">Save</button>
                <button type="button" class="btn btn-danger-soft my-0" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>  
