<ngx-spinner bdColor="rgba(51,51,51,0.8)" size="medium" color="#fff" type="ball-scale-multiple" [fullScreen]="true">
    <p style="font-size: 30px; color: white">{{ 'PAYOUT_SETTINGS.LOADING' | translate }}</p>
</ngx-spinner>

<div class="row mb-4">
    <div class="col-12">
        <h1 class="h3 mb-2">{{ 'PAYOUT_SETTINGS.PAGE_TITLE' | translate }}</h1>
        <p class="text-muted">{{ 'PAYOUT_SETTINGS.PAGE_DESCRIPTION' | translate }}</p>
    </div>
</div>

<div class="row g-4">
    <!-- Preferred Payout Method -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">{{ 'PAYOUT_SETTINGS.PREFERRED_METHOD' | translate }}</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <!-- Stripe Connect Card -->
                    <div class="col-md-4">
                        <div class="card border h-100" [class.border-primary]="preferredMethod === 'stripe'">
                            <div class="card-body d-flex flex-column">
                                <h6>{{ 'PAYOUT_SETTINGS.STRIPE_CONNECT' | translate }}</h6>
                                <p class="text-muted small">{{ 'PAYOUT_SETTINGS.STRIPE_DESCRIPTION' | translate }}</p>
                                <div class="mb-2">
                                    <span class="badge" [ngClass]="stripeAccountId ? 'bg-success' : 'bg-warning'">
                                        {{ (stripeAccountId ? 'PAYOUT_SETTINGS.CONFIGURED' : 'PAYOUT_SETTINGS.NOT_CONFIGURED') | translate }}
                                    </span>
                                </div>
                                <div class="mt-auto">
                                    <button 
                                        class="btn btn-sm w-100" 
                                        [ngClass]="preferredMethod === 'stripe' ? 'btn-primary' : 'btn-outline-primary'"
                                        [disabled]="!isMethodAvailable('stripe')"
                                        (click)="updatePreferredMethod('stripe')">
                                        {{ (preferredMethod === 'stripe' ? 'PAYOUT_SETTINGS.SELECTED' : 'PAYOUT_SETTINGS.SELECT') | translate }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- PayPal Card -->
                    <div class="col-md-4">
                        <div class="card border h-100" [class.border-primary]="preferredMethod === 'paypal'">
                            <div class="card-body d-flex flex-column">
                                <h6>{{ 'PAYOUT_SETTINGS.PAYPAL' | translate }}</h6>
                                <p class="text-muted small">{{ 'PAYOUT_SETTINGS.PAYPAL_DESCRIPTION' | translate }}</p>
                                <div class="mb-2">
                                    <span class="badge" [ngClass]="paypalEmail ? 'bg-success' : 'bg-warning'">
                                        {{ (paypalEmail ? 'PAYOUT_SETTINGS.CONFIGURED' : 'PAYOUT_SETTINGS.NOT_CONFIGURED') | translate }}
                                    </span>
                                </div>
                                <div class="mt-auto">
                                    <button 
                                        class="btn btn-sm w-100" 
                                        [ngClass]="preferredMethod === 'paypal' ? 'btn-primary' : 'btn-outline-primary'"
                                        [disabled]="!isMethodAvailable('paypal')"
                                        (click)="updatePreferredMethod('paypal')">
                                        {{ (preferredMethod === 'paypal' ? 'PAYOUT_SETTINGS.SELECTED' : 'PAYOUT_SETTINGS.SELECT') | translate }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Bank Transfer Card -->
                    <div class="col-md-4">
                        <div class="card border h-100" [class.border-primary]="preferredMethod === 'bank_transfer'">
                            <div class="card-body d-flex flex-column">
                                <h6>{{ 'PAYOUT_SETTINGS.BANK_TRANSFER' | translate }}</h6>
                                <p class="text-muted small">{{ 'PAYOUT_SETTINGS.BANK_TRANSFER_DESCRIPTION' | translate }}</p>
                                <div class="mb-2">
                                    <span class="badge" [ngClass]="bankDetailsConfigured ? 'bg-success' : 'bg-warning'">
                                        {{ (bankDetailsConfigured ? 'PAYOUT_SETTINGS.CONFIGURED' : 'PAYOUT_SETTINGS.NOT_CONFIGURED') | translate }}
                                    </span>
                                </div>
                                <div class="mt-auto">
                                    <button 
                                        class="btn btn-sm w-100" 
                                        [ngClass]="preferredMethod === 'bank_transfer' ? 'btn-primary' : 'btn-outline-primary'"
                                        [disabled]="!isMethodAvailable('bank_transfer')"
                                        (click)="updatePreferredMethod('bank_transfer')">
                                        {{ (preferredMethod === 'bank_transfer' ? 'PAYOUT_SETTINGS.SELECTED' : 'PAYOUT_SETTINGS.SELECT') | translate }}
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- PayPal Email Configuration -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">{{ 'PAYOUT_SETTINGS.PAYPAL_EMAIL' | translate }}</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <label class="form-label">{{ 'PAYOUT_SETTINGS.PAYPAL_EMAIL_ADDRESS' | translate }}</label>
                        <div class="input-group">
                            <input 
                                type="email" 
                                class="form-control" 
                                [(ngModel)]="newPaypalEmail"
                                [placeholder]="'PAYOUT_SETTINGS.PAYPAL_EMAIL_PLACEHOLDER' | translate">
                            <button 
                                class="btn btn-primary" 
                                (click)="updatePayPalEmail()"
                                [disabled]="!newPaypalEmail || newPaypalEmail === paypalEmail">
                                {{ 'PAYOUT_SETTINGS.UPDATE' | translate }}
                            </button>
                        </div>
                        <small class="text-muted">{{ 'PAYOUT_SETTINGS.PAYPAL_EMAIL_HELP' | translate }}</small>
                        <div *ngIf="paypalEmail" class="mt-2">
                            <small class="text-success">{{ 'PAYOUT_SETTINGS.CURRENT' | translate }}: {{paypalEmail}}</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Stripe Connect Account ID Configuration -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">{{ 'PAYOUT_SETTINGS.STRIPE_ACCOUNT_ID' | translate }}</h5>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-8">
                        <label class="form-label">{{ 'PAYOUT_SETTINGS.STRIPE_ACCOUNT_ID' | translate }}</label>
                        <div class="input-group">
                            <input 
                                type="text" 
                                class="form-control" 
                                [(ngModel)]="newStripeAccountId"
                                [placeholder]="'PAYOUT_SETTINGS.STRIPE_PLACEHOLDER' | translate">
                            <button 
                                class="btn btn-primary" 
                                (click)="updateStripeAccountId()"
                                [disabled]="!newStripeAccountId || newStripeAccountId === stripeAccountId">
                                {{ 'PAYOUT_SETTINGS.UPDATE' | translate }}
                            </button>
                        </div>
                        <small class="text-muted">{{ 'PAYOUT_SETTINGS.STRIPE_ACCOUNT_ID_HELP' | translate }}</small>
                        <div *ngIf="stripeAccountId" class="mt-2">
                            <small class="text-success">{{ 'PAYOUT_SETTINGS.CURRENT' | translate }}: {{stripeAccountId}}</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bank Details Configuration -->
    <div class="col-12">
        <div class="card">
            <div class="card-header">
                <h5 class="mb-0">{{ 'PAYOUT_SETTINGS.BANK_ACCOUNT_DETAILS' | translate }}</h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label">{{ 'PAYOUT_SETTINGS.ACCOUNT_HOLDER_NAME' | translate }} <span class="text-danger">*</span></label>
                        <input 
                            type="text" 
                            class="form-control" 
                            [(ngModel)]="newBankDetails.account_holder"
                            [placeholder]="'PAYOUT_SETTINGS.ACCOUNT_HOLDER_PLACEHOLDER' | translate"
                            maxlength="100">
                        <small class="text-muted">{{ 'PAYOUT_SETTINGS.ACCOUNT_HOLDER_2_100' | translate }}</small>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">{{ 'PAYOUT_SETTINGS.ACCOUNT_NUMBER_IBAN' | translate }} <span class="text-danger">*</span></label>
                        <input 
                            type="text" 
                            class="form-control" 
                            [(ngModel)]="newBankDetails.account_number"
                            [placeholder]="'PAYOUT_SETTINGS.ACCOUNT_NUMBER_PLACEHOLDER' | translate"
                            maxlength="40">
                        <small class="text-muted">{{ 'PAYOUT_SETTINGS.ACCOUNT_NUMBER_HELP' | translate }}</small>
                    </div>
                    <div class="col-md-6">
                        <label class="form-label">{{ 'PAYOUT_SETTINGS.ROUTING_NUMBER' | translate }} <span class="text-danger">*</span></label>
                        <input 
                            type="text" 
                            class="form-control" 
                            [(ngModel)]="newBankDetails.routing_number"
                            [placeholder]="'PAYOUT_SETTINGS.ROUTING_NUMBER_PLACEHOLDER' | translate"
                            maxlength="9">
                        <small class="text-muted">{{ 'PAYOUT_SETTINGS.ROUTING_NUMBER_HELP' | translate }}</small>
                    </div>
                    <div class="col-md-12">
                        <button 
                            class="btn btn-primary" 
                            (click)="updateBankDetails()"
                            [disabled]="!newBankDetails.account_number || !newBankDetails.routing_number || !newBankDetails.account_holder ||
                                       (newBankDetails.account_number === bankDetails.account_number && 
                                        newBankDetails.routing_number === bankDetails.routing_number && 
                                        newBankDetails.account_holder === bankDetails.account_holder)">
                            {{ 'PAYOUT_SETTINGS.UPDATE_BANK_DETAILS' | translate }}
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
